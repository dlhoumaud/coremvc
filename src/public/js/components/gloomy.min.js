export default app=>{app.component("gloomy",{template:`<canvas ref="animationCanvas" id="animationCanvas" width="300" height="300"></canvas>`,mounted(){const canvas=this.$refs.animationCanvas;const scaleFactor=window.devicePixelRatio||1;canvas.width=canvas.width*scaleFactor;canvas.height=canvas.height*scaleFactor;const gloomy_ctx=canvas.getContext("2d");if(!canvas||!gloomy_ctx){console.error("Canvas non trouvé !");return}Promise.all([loadFrames("assets/images/frames/gloomy-talk",2),loadFrames("assets/images/frames/gloomy-eyes",2)]).then((([talkFrames,eyesFrames])=>{startAnimation(canvas,gloomy_ctx,talkFrames,eyesFrames)})).catch((error=>{console.error("Erreur lors du chargement des frames:",error)}))}})};function loadFrames(baseName,frameCount){const frames=[];const promises=[];for(let i=0;i<frameCount;i++){const img=new Image;img.src=`${baseName}-${i}.png`;const imgPromise=new Promise(((resolve,reject)=>{img.onload=()=>resolve(img);img.onerror=()=>reject(`Erreur de chargement : ${img.src}`)}));frames.push(img);promises.push(imgPromise)}return Promise.all(promises).then((()=>frames))}function playAnimation(frames,gloomy_ctx,canvas,frameRate,callback){let currentFrame=0;let lastFrameTime=0;function animate(timestamp){if(timestamp-lastFrameTime>1e3/frameRate){gloomy_ctx.clearRect(0,0,canvas.width,canvas.height);gloomy_ctx.drawImage(frames[currentFrame],0,0,canvas.width,canvas.height);currentFrame++;if(currentFrame>=frames.length){callback();return}lastFrameTime=timestamp}requestAnimationFrame(animate)}requestAnimationFrame(animate)}function startAnimation(canvas,gloomy_ctx,talkFrames,eyesFrames){drawSingleFrame(gloomy_ctx,canvas,eyesFrames[0]);function triggerEyesAnimation(){setInterval((()=>{if(Math.random()<.5){playAnimation(eyesFrames,gloomy_ctx,canvas,4,(()=>{setTimeout((()=>{drawSingleFrame(gloomy_ctx,canvas,eyesFrames[0])}),1e3/4)}))}else{drawSingleFrame(gloomy_ctx,canvas,eyesFrames[0])}}),5e3)}triggerEyesAnimation()}function drawSingleFrame(gloomy_ctx,canvas,frame){if(!frame.complete){console.log("L'image n'est pas encore chargée, on attend...");return}gloomy_ctx.clearRect(0,0,canvas.width,canvas.height);gloomy_ctx.drawImage(frame,0,0,canvas.width,canvas.height)}